<div class="shape-toolbar">
  <!-- Toolbar Header -->
  <div class="toolbar-header">
    <h3 class="toolbar-title">Shapes</h3>
  </div>

  <!-- Category Tabs -->
  <div class="category-tabs">
    <button
      *ngFor="let category of categories"
      class="category-tab"
      [class.active]="selectedCategory === category.id"
      (click)="onCategorySelect(category.id)"
      [attr.aria-label]="'Select ' + category.name + ' category'"
    >
      <span class="category-icon" [ngClass]="getCategoryIconClass(category)"></span>
      <span class="category-name">{{ category.name }}</span>
    </button>
  </div>

  <!-- Action buttons shown only when a selection exists -->
  <div class="selection-actions" *ngIf="(diagramService.selection$ | async)?.hasSelection">
    <button
      class="btn btn-danger"
      (click)="diagramService.deleteSelected()"
      aria-label="Delete Selection"
      title="Delete"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          fill="currentColor"
          d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2zM9 9h2v10H9V9zm4 0h2v10h-2V9z"
        />
      </svg>
      <span class="sr-only">Delete</span>
    </button>
    <button
      class="btn btn-secondary"
      (click)="onDuplicateSelection()"
      aria-label="Duplicate Selection"
      title="Duplicate"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          fill="currentColor"
          d="M16 1H6c-1.1 0-2 .9-2 2v10h2V3h10V1zm3 4H10c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 13H10V7h9v11z"
        />
      </svg>
      <span class="sr-only">Duplicate</span>
    </button>
  </div>

  <!-- Shapes Grid -->
  <div class="shapes-container">
    <div class="shapes-grid">
      <div
        *ngFor="let shape of filteredShapes"
        class="shape-item"
        [class.hovered]="isShapeHovered(getShapeType(shape))"
        [class.inserting]="isShapeInserting(shape.name)"
        [class.insertion-success]="isShapeInsertionSuccess(shape.name)"
        [class.insertion-error]="isShapeInsertionError(shape.name)"
        (mouseenter)="onShapeHover(getShapeType(shape))"
        (mouseleave)="onShapeHoverEnd()"
        (click)="onShapeClick(shape)"
        (keydown)="onShapeKeyDown($event, shape)"
        [title]="shape.description"
        [attr.aria-label]="
          'Insert ' +
          shape.name +
          ' shape' +
          (shape.shortcut ? ' (shortcut: ' + shape.shortcut + ')' : '')
        "
        [attr.aria-describedby]="'shape-desc-' + getShapeType(shape)"
        role="button"
        tabindex="0"
        [attr.aria-disabled]="isShapeInserting(shape.name)"
      >
        <div class="shape-preview">
          <div class="shape-icon" [ngClass]="getShapeIconClass(shape)"></div>
          <!-- Loading spinner -->
          <div class="insertion-loading" *ngIf="isShapeInserting(shape.name)">
            <div class="spinner"></div>
          </div>
          <!-- Success checkmark -->
          <div class="insertion-success-icon" *ngIf="isShapeInsertionSuccess(shape.name)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>
          </div>
          <!-- Error icon -->
          <div class="insertion-error-icon" *ngIf="isShapeInsertionError(shape.name)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              />
            </svg>
          </div>
        </div>
        <div class="shape-info">
          <span class="shape-name">{{ shape.name }}</span>
          <span class="shape-shortcut" *ngIf="shape.shortcut">{{ getShortcutText(shape) }}</span>
        </div>
        <!-- Hidden description for screen readers -->
        <div [id]="'shape-desc-' + getShapeType(shape)" class="sr-only">
          {{ shape.description || 'A ' + shape.name.toLowerCase() + ' shape for diagrams' }}
          <span *ngIf="shape.shortcut">Press {{ shape.shortcut }} to insert this shape.</span>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div class="no-results" *ngIf="filteredShapes.length === 0">
      <p>No shapes found</p>
      <small>Try adjusting your search or select a different category</small>
    </div>
  </div>
</div>
