<div class="diagram-canvas-container">
  <div class="left-toolbar" role="toolbar" aria-label="Diagram toolbar" data-testid="left-toolbar">
    <!-- Shapes Section -->
    <div class="toolbar-section">
      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <input
          type="text"
          class="search-input"
          placeholder="Search shapes..."
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          aria-label="Search shapes"
        />
        @if (searchQuery) {
        <button class="search-clear" (click)="clearSearch()" aria-label="Clear search">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        }
      </div>


      <!-- Shapes Grid -->
      <div class="shapes-container">
        <div class="shapes-grid">
          @for (shape of filteredShapes; track getShapeType(shape)) {
          <div
            class="shape-item"
            [class.hovered]="isShapeHovered(getShapeType(shape))"
            [attr.data-shape-type]="getShapeType(shape)"
            (mouseenter)="onShapeHover(getShapeType(shape))"
            (mouseleave)="onShapeHoverEnd()"
            (click)="onShapeClick(shape)"
            [title]="shape.description"
          >
            <div class="shape-preview">
              <div class="shape-icon" [ngClass]="getShapeIconClass(shape)"></div>
              <div class="shape-overlay">
                <div class="shape-add-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </div>
              </div>
            </div>
            <div class="shape-info">
              <span class="shape-name">{{ shape.name }}</span>
            </div>
          </div>
          }
        </div>

        <!-- No Results Message -->
        @if (filteredShapes.length === 0) {
        <div class="no-results">
          <h4>No shapes found</h4>
          <p>Try adjusting your search</p>
        </div>
        }
      </div>
    </div>

    <div class="toolbar-divider"></div>

    <!-- Tools Section -->
    <div class="toolbar-section">
      <div class="section-header">
        <h3 class="section-title">Canvas Tools</h3>
      </div>
      
      <!-- Clear Button -->
      <div class="tool-group">
        <button class="btn btn-danger" (click)="onClearDiagram()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3,6 5,6 21,6"></polyline>
            <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Clear Canvas
        </button>
      </div>

      <!-- Zoom Controls -->
      <div class="tool-group">
        <div class="tool-group-header">
          <span class="tool-group-title">Zoom</span>
          <span class="zoom-display">{{ currentZoom * 100 | number : '1.0-0' }}%</span>
        </div>
        <div class="zoom-controls">
          <button
            class="btn btn-icon"
            (click)="onZoomOut()"
            data-testid="btn-zoom-out"
            [attr.aria-label]="'Zoom out at cursor position'"
            title="Zoom out at cursor position"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
          </button>
          <button
            class="btn btn-icon"
            (click)="onZoomIn()"
            data-testid="btn-zoom-in"
            [attr.aria-label]="'Zoom in at cursor position'"
            title="Zoom in at cursor position"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="11" y1="8" x2="11" y2="14"></line>
              <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Grid Controls -->
      <div class="tool-group">
        <div class="tool-group-header">
          <span class="tool-group-title">Grid</span>
          <span class="grid-status" [class.active]="isGridEnabled">
            {{ isGridEnabled ? 'On' : 'Off' }}
          </span>
        </div>
        <button
          class="btn btn-toggle"
          [class.active]="isGridEnabled"
          (click)="onToggleGrid()"
          data-testid="btn-grid-toggle"
          [attr.aria-pressed]="isGridEnabled"
          aria-label="Toggle grid"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          Toggle Grid
        </button>
      </div>
    </div>
  </div>

  <div #diagramContainer class="diagram-container"></div>
</div>
